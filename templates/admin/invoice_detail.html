{% extends "admin/base.html" %}

{% block title %}Invoice {{ invoice.invoice_number }}{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h2>
            <i class="fas fa-file-invoice-dollar"></i> Invoice {{ invoice.invoice_number }}
        </h2>
    </div>
    <div class="col-md-4 text-end">
        <a href="{{ url_for('admin_invoice_edit', invoice_id=invoice.id) }}" class="btn btn-warning">
            <i class="fas fa-edit"></i> Edit
        </a>
        <a href="{{ url_for('admin_invoices') }}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left"></i> Back
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body p-4">
        <!-- Header Section -->
        <div class="row mb-4">
            <div class="col-md-6">
                <h5 style="color: var(--primary);">Company Information</h5>
                {% if company_info %}
                    <p class="mb-1"><strong>{{ company_info.company_name }}</strong></p>
                    <p class="mb-1"><small>{{ company_info.address }}</small></p>
                    <p class="mb-1"><small>{{ company_info.phone }}</small></p>
                    <p class="mb-0"><small>{{ company_info.email }}</small></p>
                {% endif %}
            </div>
            <div class="col-md-6 text-md-end">
                <h5 style="color: var(--primary);">Customer Information</h5>
                <p class="mb-1"><strong>{{ invoice.customer.get_full_name() }}</strong></p>
                <p class="mb-1"><small>{{ invoice.customer.email }}</small></p>
                {% if invoice.customer.company %}
                    <p class="mb-1"><small>{{ invoice.customer.company }}</small></p>
                {% endif %}
                {% if invoice.customer.phone %}
                    <p class="mb-0"><small>{{ invoice.customer.phone }}</small></p>
                {% endif %}
            </div>
        </div>

        <hr>

        <!-- Invoice Details -->
        <div class="row mb-4">
            <div class="col-md-3">
                <h6 class="text-muted">Invoice #</h6>
                <p class="h5" style="color: var(--primary);">{{ invoice.invoice_number }}</p>
            </div>
            <div class="col-md-3">
                <h6 class="text-muted">Issue Date</h6>
                <p>{{ invoice.issue_date.strftime('%d %b %Y') }}</p>
            </div>
            <div class="col-md-3">
                <h6 class="text-muted">Due Date</h6>
                <p class="{% if invoice.is_overdue() %}text-danger fw-bold{% endif %}">
                    {{ invoice.due_date.strftime('%d %b %Y') }}
                </p>
            </div>
            <div class="col-md-3">
                <h6 class="text-muted">Status</h6>
                <p>
                    {% if invoice.status == 'paid' %}
                        <span class="badge bg-success"><i class="fas fa-check-circle"></i> Paid</span>
                    {% elif invoice.is_overdue() %}
                        <span class="badge bg-danger"><i class="fas fa-exclamation-circle"></i> Overdue</span>
                    {% elif invoice.status == 'partial' %}
                        <span class="badge bg-warning"><i class="fas fa-hourglass-half"></i> Partial</span>
                    {% else %}
                        <span class="badge bg-secondary">{{ invoice.status|capitalize }}</span>
                    {% endif %}
                </p>
            </div>
        </div>

        <hr>

        <!-- Amount Summary -->
        <div class="row">
            <div class="col-md-8"></div>
            <div class="col-md-4">
                <table class="table table-sm">
                    <tr>
                        <td>Subtotal:</td>
                        <td class="text-end"><strong>R{{ "%.2f"|format(invoice.subtotal) }}</strong></td>
                    </tr>
                    <tr>
                        <td>Tax (VAT):</td>
                        <td class="text-end"><strong>R{{ "%.2f"|format(invoice.tax_amount) }}</strong></td>
                    </tr>
                    <tr style="border-top: 2px solid var(--primary);">
                        <td><strong>Total:</strong></td>
                        <td class="text-end"><strong style="font-size: 1.2rem; color: var(--primary);">R{{ "%.2f"|format(invoice.total_amount) }}</strong></td>
                    </tr>
                    <tr style="background-color: rgba(26, 71, 42, 0.05);">
                        <td><strong>Paid:</strong></td>
                        <td class="text-end"><strong style="color: #28a745;">R{{ "%.2f"|format(invoice.paid_amount) }}</strong></td>
                    </tr>
                    <tr style="background-color: rgba(220, 53, 69, 0.05); border-bottom: 2px solid var(--primary);">
                        <td><strong>Balance:</strong></td>
                        <td class="text-end"><strong style="color: #dc3545;">R{{ "%.2f"|format(invoice.remaining_balance()) }}</strong></td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Payments Section -->
        {% if invoice.payments %}
            <hr class="my-4">
            <h5 style="color: var(--primary);" class="mb-3">
                <i class="fas fa-history"></i> Payment History
            </h5>
            <div class="table-responsive">
                <table class="table table-sm table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Date</th>
                            <th>Amount</th>
                            <th>Method</th>
                            <th>Transaction ID</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for payment in invoice.payments %}
                            <tr>
                                <td>{{ payment.payment_date.strftime('%d %b %Y') }}</td>
                                <td><strong>R{{ "%.2f"|format(payment.amount) }}</strong></td>
                                <td>{{ payment.payment_method|capitalize }}</td>
                                <td><small>{{ payment.transaction_id or 'N/A' }}</small></td>
                                <td><small>{{ payment.notes or '-' }}</small></td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}

        <!-- Notes Section -->
        {% if invoice.notes %}
            <hr class="my-4">
            <h5 style="color: var(--primary);" class="mb-3">
                <i class="fas fa-sticky-note"></i> Notes
            </h5>
            <p style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary);">
                {{ invoice.notes }}
            </p>
        {% endif %}

        <!-- Terms Section -->
        {% if invoice.terms %}
            <hr class="my-4">
            <h5 style="color: var(--primary);" class="mb-3">
                <i class="fas fa-file-contract"></i> Terms & Conditions
            </h5>
            <p style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary);">
                {{ invoice.terms }}
            </p>
        {% endif %}
    </div>
</div>
{% endblock %}
