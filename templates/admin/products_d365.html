{% extends "admin/base.html" %}

{% block title %}Products Management - Admin{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Breadcrumb & Page Title -->
    <div style="margin-bottom: 16px;">
        <div class="breadcrumb-d365">
            <a href="{{ url_for('admin_dashboard') }}">Home</a>
            <span class="separator">/</span>
            <span>Products</span>
        </div>
        <h1 style="font-size: 20px; font-weight: 600; margin: 4px 0 0 0; color: #323130;">Products</h1>
    </div>

    <!-- Command Bar -->
    <div class="command-bar-d365">
        <div class="command-bar-left">
            <a href="{{ url_for('admin_product_add') }}" class="btn-d365-primary" style="font-size: 12px; padding: 6px 12px;">
                <i class="fas fa-plus"></i>
                <span>New</span>
            </a>
            <button class="btn-d365-secondary" style="font-size: 12px; padding: 6px 12px;" disabled>
                <i class="fas fa-edit"></i>
                <span>Edit</span>
            </button>
            <button class="btn-d365-secondary" style="font-size: 12px; padding: 6px 12px;" disabled>
                <i class="fas fa-trash"></i>
                <span>Delete</span>
            </button>
            <div style="width: 1px; height: 24px; background: #edebe9; margin: 0 4px;"></div>
            <button class="btn-d365-secondary" style="font-size: 12px; padding: 6px 12px;">
                <i class="fas fa-sync"></i>
                <span>Refresh</span>
            </button>
        </div>
        <div class="command-bar-right">
            <div class="search-box-d365">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Filter" />
            </div>
        </div>
    </div>

    <!-- Products Table -->
    <div class="d365-card">
        <div class="card-body-d365" style="padding: 0;">
            <table class="table-d365">
                <thead>
                    <tr>
                        <th class="row-checkbox">
                            <input type="checkbox" id="selectAll" />
                        </th>
                        <th class="sortable">
                            <div class="column-header">
                                <span class="column-title">Product name</span>
                                <span class="column-icons">
                                    <i class="fas fa-filter filter-icon"></i>
                                    <i class="fas fa-sort sort-icon"></i>
                                </span>
                            </div>
                        </th>
                        <th class="sortable">
                            <div class="column-header">
                                <span class="column-title">Category</span>
                                <span class="column-icons">
                                    <i class="fas fa-filter filter-icon"></i>
                                    <i class="fas fa-sort sort-icon"></i>
                                </span>
                            </div>
                        </th>
                        <th class="sortable" style="text-align: right;">
                            <div class="column-header">
                                <span class="column-title">ZAR Price</span>
                                <span class="column-icons">
                                    <i class="fas fa-filter filter-icon"></i>
                                    <i class="fas fa-sort sort-icon"></i>
                                </span>
                            </div>
                        </th>
                        <th class="sortable" style="text-align: right;">
                            <div class="column-header">
                                <span class="column-title">USD Price</span>
                                <span class="column-icons">
                                    <i class="fas fa-filter filter-icon"></i>
                                    <i class="fas fa-sort sort-icon"></i>
                                </span>
                            </div>
                        </th>
                        <th class="sortable">
                            <div class="column-header">
                                <span class="column-title">Unit</span>
                                <span class="column-icons">
                                    <i class="fas fa-filter filter-icon"></i>
                                </span>
                            </div>
                        </th>
                        <th class="sortable">
                            <div class="column-header">
                                <span class="column-title">Status</span>
                                <span class="column-icons">
                                    <i class="fas fa-filter filter-icon"></i>
                                </span>
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr onclick="selectRow(this, event)" style="cursor: pointer;">
                        <td class="row-checkbox">
                            <input type="checkbox" class="row-select" onclick="event.stopPropagation();" />
                        </td>
                        <td>
                            <a href="{{ url_for('admin_product_edit', id=product.id) }}">{{ product.name }}</a>
                        </td>
                        <td>{{ product.category }}</td>
                        <td style="text-align: right;">
                            {% if product.price_zar %}
                                R {{ "%.2f"|format(product.price_zar) }}
                            {% elif product.price %}
                                R {{ "%.2f"|format(product.price) }}
                            {% else %}
                                <span style="color: #a19f9d;">—</span>
                            {% endif %}
                        </td>
                        <td style="text-align: right;">
                            {% if product.price_usd %}
                                ${{ "%.2f"|format(product.price_usd) }}
                            {% else %}
                                <span style="color: #a19f9d;">—</span>
                            {% endif %}
                        </td>
                        <td>{{ product.unit }}</td>
                        <td>
                            {% if product.is_active %}
                                <span class="badge-d365 success" style="font-size: 11px;">Active</span>
                            {% else %}
                                <span class="badge-d365 warning" style="font-size: 11px;">Inactive</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 48px; color: #a19f9d;">
                            <i class="fas fa-box" style="font-size: 36px; margin-bottom: 12px; display: block; opacity: 0.3;"></i>
                            <p style="margin: 0; font-size: 13px;">No products found. Click "New" to add your first product.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Footer Info -->
    <div style="margin-top: 12px; font-size: 12px; color: #605e5c;">
        <span>Total records: {{ products|length }}</span>
    </div>
</div>

<style>
    .dashboard-container {
        max-width: 100%;
        margin: 0;
        padding: 0;
    }

    body {
        background: #faf9f8 !important;
    }

    .content {
        background: #faf9f8 !important;
        padding: 16px 24px !important;
    }
</style>

<script>
// Select All Checkbox
document.getElementById('selectAll')?.addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('.row-select');
    checkboxes.forEach(cb => cb.checked = this.checked);
    updateCommandBar();
});

// Row Selection
function selectRow(row, event) {
    if (event.target.type === 'checkbox' || event.target.tagName === 'A') return;
    const checkbox = row.querySelector('.row-select');
    checkbox.checked = !checkbox.checked;
    updateCommandBar();
}

// Update Command Bar based on selection
function updateCommandBar() {
    const selectedCount = document.querySelectorAll('.row-select:checked').length;
    const editBtn = document.querySelector('.command-bar-left button:nth-child(2)');
    const deleteBtn = document.querySelector('.command-bar-left button:nth-child(3)');
    
    if (selectedCount > 0) {
        editBtn.disabled = selectedCount !== 1;
        deleteBtn.disabled = false;
    } else {
        editBtn.disabled = true;
        deleteBtn.disabled = true;
    }
}

// Refresh Button
document.querySelector('.command-bar-left button:last-child')?.addEventListener('click', function() {
    location.reload();
});
</script>
{% endblock %}
