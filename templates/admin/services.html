{% extends "admin/base.html" %}

{% block title %}Services Management - Admin{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Breadcrumb & Page Title -->
    <div style="margin-bottom: 16px;">
        <div class="breadcrumb-d365">
            <a href="{{ url_for('admin_dashboard') }}">Home</a>
            <span class="separator">/</span>
            <span>Services</span>
        </div>
        <h1 style="font-size: 20px; font-weight: 600; margin: 4px 0 0 0; color: #323130;">Services</h1>
    </div>

    <!-- Command Bar -->
    <div class="command-bar-d365">
        <div class="command-bar-left">
            <a href="{{ url_for('admin_service_add') }}" class="btn-d365-primary" style="font-size: 12px; padding: 6px 12px;">
                <i class="fas fa-plus"></i>
                <span>New</span>
            </a>
            <button class="btn-d365-secondary" style="font-size: 12px; padding: 6px 12px;" disabled>
                <i class="fas fa-edit"></i>
                <span>Edit</span>
            </button>
            <button class="btn-d365-secondary" style="font-size: 12px; padding: 6px 12px;" disabled>
                <i class="fas fa-trash"></i>
                <span>Delete</span>
            </button>
            <div style="width: 1px; height: 24px; background: #edebe9; margin: 0 4px;"></div>
            <button class="btn-d365-secondary" style="font-size: 12px; padding: 6px 12px;" onclick="location.reload()">
                <i class="fas fa-sync"></i>
                <span>Refresh</span>
            </button>
        </div>
        <div class="command-bar-right">
            <div class="search-box-d365">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Filter" id="filterInput" />
            </div>
        </div>
    </div>

    <!-- Services Table -->
    <div class="d365-card">
        <div class="card-body-d365" style="padding: 0;">
            <table class="table-d365">
                <thead>
                    <tr>
                        <th class="row-checkbox">
                            <input type="checkbox" id="selectAll" />
                        </th>
                        <th class="sortable">
                            <div class="column-header">
                                <span class="column-title">Service title</span>
                                <span class="column-icons">
                                    <i class="fas fa-filter filter-icon"></i>
                                    <i class="fas fa-sort sort-icon"></i>
                                </span>
                            </div>
                        </th>
                        <th class="sortable">
                            <div class="column-header">
                                <span class="column-title">Description</span>
                                <span class="column-icons">
                                    <i class="fas fa-filter filter-icon"></i>
                                </span>
                            </div>
                        </th>
                        <th class="sortable" style="width: 80px;">
                            <div class="column-header">
                                <span class="column-title">Icon</span>
                                <span class="column-icons">
                                    <i class="fas fa-filter filter-icon"></i>
                                </span>
                            </div>
                        </th>
                        <th class="sortable" style="width: 100px; text-align: center;">
                            <div class="column-header">
                                <span class="column-title">Display order</span>
                                <span class="column-icons">
                                    <i class="fas fa-sort sort-icon"></i>
                                </span>
                            </div>
                        </th>
                        <th class="sortable" style="width: 100px;">
                            <div class="column-header">
                                <span class="column-title">Status</span>
                                <span class="column-icons">
                                    <i class="fas fa-filter filter-icon"></i>
                                </span>
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for service in services %}
                    <tr onclick="selectRow(this, event)" style="cursor: pointer;">
                        <td class="row-checkbox">
                            <input type="checkbox" class="row-select" onclick="event.stopPropagation();" />
                        </td>
                        <td>
                            <a href="{{ url_for('admin_service_edit', id=service.id) }}">{{ service.title }}</a>
                        </td>
                        <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            {{ service.description[:80] }}{% if service.description|length > 80 %}...{% endif %}
                        </td>
                        <td style="text-align: center;">
                            <i class="fas {{ service.icon }}" style="font-size: 16px; color: #0078d4;"></i>
                        </td>
                        <td style="text-align: center;">{{ service.order_position }}</td>
                        <td>
                            {% if service.is_active %}
                                <span class="badge-d365 success" style="font-size: 11px;">Active</span>
                            {% else %}
                                <span class="badge-d365 warning" style="font-size: 11px;">Inactive</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 48px; color: #a19f9d;">
                            <i class="fas fa-cogs" style="font-size: 36px; margin-bottom: 12px; display: block; opacity: 0.3;"></i>
                            <p style="margin: 0; font-size: 13px;">No services found. Click "New" to add your first service.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Footer Info -->
    <div style="margin-top: 12px; font-size: 12px; color: #605e5c;">
        <span>Total records: {{ services|length }}</span>
    </div>
</div>

<style>
    .dashboard-container {
        max-width: 100%;
        margin: 0;
        padding: 0;
    }

    body {
        background: #faf9f8 !important;
    }

    .content {
        background: #faf9f8 !important;
        padding: 16px 24px !important;
    }
</style>

<script>
// Select All Checkbox
document.getElementById('selectAll')?.addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('.row-select');
    checkboxes.forEach(cb => cb.checked = this.checked);
    updateCommandBar();
});

// Row Selection
function selectRow(row, event) {
    if (event.target.type === 'checkbox' || event.target.tagName === 'A') return;
    const checkbox = row.querySelector('.row-select');
    checkbox.checked = !checkbox.checked;
    updateCommandBar();
}

// Update Command Bar based on selection
function updateCommandBar() {
    const selectedCount = document.querySelectorAll('.row-select:checked').length;
    const editBtn = document.querySelector('.command-bar-left button:nth-child(2)');
    const deleteBtn = document.querySelector('.command-bar-left button:nth-child(3)');
    
    if (selectedCount > 0) {
        editBtn.disabled = selectedCount !== 1;
        deleteBtn.disabled = false;
    } else {
        editBtn.disabled = true;
        deleteBtn.disabled = true;
    }
}

// Filter functionality
document.getElementById('filterInput')?.addEventListener('input', function(e) {
    const filter = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('.table-d365 tbody tr');
    
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? '' : 'none';
    });
});
</script>
{% endblock %}
