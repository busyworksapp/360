{% extends "customer/base.html" %}

{% block title %}Transaction Details{% endblock %}

{% block extra_css %}
<style>
    .dashboard-container {
        background: #1C1C1C;
        padding: 0;
    }

    .dashboard-header {
        background: #353535;
        border-bottom: 1px solid #4A4A4A;
        padding: 16px 24px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .dashboard-header h1 {
        font-size: 20px;
        font-weight: 600;
        color: #FFFFFF;
        margin: 0;
    }

    .dashboard-header .subtitle {
        font-size: 12px;
        color: #C0C0C0;
        margin-top: 4px;
    }

    .info-section {
        background: #353535;
        border: 1px solid #4A4A4A;
        padding: 16px;
        margin-bottom: 20px;
    }

    .info-section h3 {
        font-size: 14px;
        font-weight: 600;
        color: #FFFFFF;
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding-bottom: 8px;
        border-bottom: 1px solid #4A4A4A;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #4A4A4A;
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-label {
        font-size: 12px;
        color: #C0C0C0;
    }

    .info-value {
        font-size: 14px;
        color: #FFFFFF;
        font-weight: 600;
    }

    .status-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 2px;
        font-size: 12px;
        font-weight: 400;
    }

    .data-grid {
        background: #353535;
        border: 1px solid #4A4A4A;
        margin-bottom: 20px;
    }

    .data-grid-header {
        padding: 12px 16px;
        border-bottom: 1px solid #4A4A4A;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .data-grid-title {
        font-size: 16px;
        font-weight: 600;
        color: #FFFFFF;
        margin: 0;
    }

    .d365-table {
        width: 100%;
        border-collapse: collapse;
    }

    .d365-table thead th {
        background: #1C1C1C;
        color: #FFFFFF;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding: 12px 16px;
        text-align: left;
        border-bottom: 1px solid #4A4A4A;
    }

    .d365-table tbody td {
        padding: 12px 16px;
        font-size: 14px;
        color: #FFFFFF;
        border-bottom: 1px solid #4A4A4A;
    }

    .d365-table tbody tr:hover {
        background: #2C2C2C;
    }

    .grid-action-btn {
        background: #353535;
        border: 1px solid #808080;
        color: #FFFFFF;
        padding: 5px 12px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.1s ease;
        text-decoration: none;
        display: inline-block;
    }

    .grid-action-btn:hover {
        background: #2C2C2C;
        border-color: #FFFFFF;
    }

    .grid-action-btn.btn-primary {
        background: #DAA520;
        border-color: #DAA520;
        color: white;
    }

    .grid-action-btn.btn-primary:hover {
        background: #B8860B;
    }

    @media print {
        .dashboard-header .grid-action-btn,
        .no-print {
            display: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Page Header -->
    <div class="dashboard-header">
        <div>
            <h1>Transaction Details</h1>
            <div class="subtitle">Payment Reference: <code style="color: #C0C0C0;">{{ transaction.payment_reference }}</code></div>
        </div>
        <div class="no-print" style="display: flex; gap: 8px;">
            <a href="{{ url_for('customer_transactions') }}" class="grid-action-btn">
                Back
            </a>
            <button onclick="window.print()" class="grid-action-btn btn-primary">
                Print
            </button>
        </div>
    </div>

    <div class="container-fluid" style="padding: 0 24px;">
        <div class="row">
            <!-- Transaction Information -->
            <div class="col-lg-6">
                <div class="info-section">
                    <h3>Transaction Information</h3>
                    <div class="info-row">
                        <span class="info-label">Payment Reference</span>
                        <span class="info-value"><code style="font-size: 12px;">{{ transaction.payment_reference }}</code></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Amount</span>
                        <span class="info-value" style="color: #4CAF50; font-size: 18px;">R {{ "{:,.2f}".format(transaction.amount) }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Currency</span>
                        <span class="info-value">{{ transaction.currency }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Payment Method</span>
                        <span class="info-value">
                            {% if transaction.payment_method == 'card' %}
                                <span class="status-badge" style="background: #2196F3 !important; color: #FFFFFF !important; font-weight: 600 !important; border: 1px solid #DAA520;">Credit/Debit Card</span>
                            {% elif transaction.payment_method == 'eft' %}
                                <span class="status-badge" style="background: #2196F3 !important; color: #FFFFFF !important; font-weight: 600 !important; border: 1px solid #DAA520;">EFT</span>
                            {% elif transaction.payment_method == 'stripe' %}
                                <span class="status-badge" style="background: #e1d5f7; color: #5c2d91; border: 1px solid #5c2d91;">Stripe</span>
                            {% else %}
                                <span class="status-badge" style="background: #2C2C2C; color: #C0C0C0; border: 1px solid #808080;">{{ transaction.payment_method|title }}</span>
                            {% endif %}
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Transaction Date</span>
                        <span class="info-value">{{ transaction.created_at.strftime('%d %B %Y at %H:%M') }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Status</span>
                        <span class="info-value">
                            {% if transaction.status == 'completed' or transaction.status == 'Completed' %}
                                <span class="status-badge" style="background: #4CAF50 !important; color: #1C1C1C !important; font-weight: 600 !important; border: 1px solid #4CAF50;">
                                    Completed
                                </span>
                            {% elif transaction.status == 'pending' or transaction.status == 'Pending' %}
                                <span class="status-badge" style="background: #FFC107 !important; color: #1C1C1C !important; font-weight: 600 !important; border: 1px solid #797673;">
                                    Pending
                                </span>
                            {% else %}
                                <span class="status-badge" style="background: #f44336 !important; color: #FFFFFF !important; font-weight: 600 !important; border: 1px solid #f44336;">
                                    Failed
                                </span>
                            {% endif %}
                        </span>
                    </div>
                    {% if transaction.refund_amount and transaction.refund_amount > 0 %}
                    <div class="info-row">
                        <span class="info-label">Refund Amount</span>
                        <span class="info-value" style="color: #f44336;">R {{ "{:,.2f}".format(transaction.refund_amount) }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Related Order -->
            <div class="col-lg-6">
                <div class="info-section">
                    <h3>Related Order</h3>
                    <div class="info-row">
                        <span class="info-label">Order Number</span>
                        <span class="info-value">{{ order.order_number }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Order Date</span>
                        <span class="info-value">{{ order.created_at.strftime('%d %B %Y') }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Order Status</span>
                        <span class="info-value">
                            {% if order.status == 'delivered' or order.status == 'Delivered' %}
                                <span class="status-badge" style="background: #4CAF50 !important; color: #1C1C1C !important; font-weight: 600 !important; border: 1px solid #4CAF50;">{{ order.status|title }}</span>
                            {% elif order.status == 'pending' or order.status == 'Pending' %}
                                <span class="status-badge" style="background: #FFC107 !important; color: #1C1C1C !important; font-weight: 600 !important; border: 1px solid #797673;">{{ order.status|title }}</span>
                            {% elif order.status == 'cancelled' or order.status == 'Cancelled' %}
                                <span class="status-badge" style="background: #f44336 !important; color: #FFFFFF !important; font-weight: 600 !important; border: 1px solid #f44336;">{{ order.status|title }}</span>
                            {% else %}
                                <span class="status-badge" style="background: #2196F3 !important; color: #FFFFFF !important; font-weight: 600 !important; border: 1px solid #DAA520;">{{ order.status|title }}</span>
                            {% endif %}
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Order Total</span>
                        <span class="info-value">R {{ "{:,.2f}".format(order.total_amount) }}</span>
                    </div>
                    <div class="info-row" style="border-bottom: none; padding-top: 12px;">
                        <a href="{{ url_for('customer_order_detail', order_id=order.id) }}" class="grid-action-btn">
                            View Order Details
                        </a>
                    </div>
                </div>
            </div>

            <!-- Related Invoice (if exists) -->
            {% if invoice %}
            <div class="col-lg-12">
                <div class="info-section">
                    <h3>Related Invoice</h3>
                    <div class="info-row">
                        <span class="info-label">Invoice Number</span>
                        <span class="info-value">{{ invoice.invoice_number }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Invoice Date</span>
                        <span class="info-value">{{ invoice.issue_date.strftime('%d %B %Y') }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Invoice Status</span>
                        <span class="info-value">
                            {% if invoice.status == 'paid' or invoice.status == 'Paid' %}
                                <span class="status-badge" style="background: #4CAF50 !important; color: #1C1C1C !important; font-weight: 600 !important; border: 1px solid #4CAF50;">Paid</span>
                            {% elif invoice.status == 'pending' or invoice.status == 'Pending' %}
                                <span class="status-badge" style="background: #FFC107 !important; color: #1C1C1C !important; font-weight: 600 !important; border: 1px solid #797673;">Pending</span>
                            {% elif invoice.status == 'overdue' or invoice.status == 'Overdue' %}
                                <span class="status-badge" style="background: #f44336 !important; color: #FFFFFF !important; font-weight: 600 !important; border: 1px solid #f44336;">Overdue</span>
                            {% else %}
                                <span class="status-badge" style="background: #2C2C2C; color: #C0C0C0; border: 1px solid #808080;">{{ invoice.status|title }}</span>
                            {% endif %}
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Invoice Amount</span>
                        <span class="info-value">R {{ "{:,.2f}".format(invoice.total_amount) }}</span>
                    </div>
                    <div class="info-row" style="border-bottom: none; padding-top: 12px;">
                        <a href="{{ url_for('customer_invoice_detail', invoice_id=invoice.id) }}" class="grid-action-btn">
                            View Invoice Details
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
